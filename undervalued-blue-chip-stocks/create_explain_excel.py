from datetime import datetime
import pandas as pd

def create_metrics_explanation_file():
    """
    ëª¨ë“  ì§€í‘œ ì„¤ëª…ì„ ì—‘ì…€ íŒŒì¼ë¡œ ìƒì„±
    """
    # ë²„í• ìŠ¤íƒ€ì¼ ì§€í‘œ ì„¤ëª…
    buffett_metrics = [
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Ticker',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì¢…ëª©ì½”ë“œ',
            'ì˜ë¯¸ í•´ì„': 'ì£¼ì‹ ì‹œì¥ì—ì„œ ì‚¬ìš©í•˜ëŠ” ê³ ìœ  ê¸°í˜¸',
            'ì¢‹ì€ ì‹ í˜¸': '-',
            'ì£¼ì˜ ì‹ í˜¸': '-'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Name',
            'í•œêµ­ì–´ ì„¤ëª…': 'íšŒì‚¬ëª…',
            'ì˜ë¯¸ í•´ì„': 'ìƒì¥íšŒì‚¬ ê³µì‹ ëª…ì¹­',
            'ì¢‹ì€ ì‹ í˜¸': '-',
            'ì£¼ì˜ ì‹ í˜¸': '-'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Sector',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì—…ì¢…/ì„¹í„°',
            'ì˜ë¯¸ í•´ì„': 'ê¸°ìˆ , í—¬ìŠ¤ì¼€ì–´, ê¸ˆìœµ ë“± ì‚°ì—… ë¶„ë¥˜',
            'ì¢‹ì€ ì‹ í˜¸': 'ì„±ì¥ì„±ì´ ì¢‹ì€ ì„¹í„°',
            'ì£¼ì˜ ì‹ í˜¸': 'ì¹¨ì²´ ì‚°ì—…'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Price',
            'í•œêµ­ì–´ ì„¤ëª…': 'í˜„ì¬ ì£¼ê°€',
            'ì˜ë¯¸ í•´ì„': 'í˜„ì¬ ì‹œì¥ì—ì„œ ê±°ë˜ë˜ëŠ” ì£¼ì‹ ê°€ê²©',
            'ì¢‹ì€ ì‹ í˜¸': 'ì ì • ê°€ê²©ëŒ€',
            'ì£¼ì˜ ì‹ í˜¸': 'ì§€ë‚˜ì¹˜ê²Œ ê³ ê°€ ë˜ëŠ” ì €ê°€'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'FairValue_Composite',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì¢…í•© ì ì •ê°€',
            'ì˜ë¯¸ í•´ì„': 'ì—¬ëŸ¬ ê°€ì¹˜ í‰ê°€ ëª¨ë¸ì„ ì¢…í•©í•˜ì—¬ ê³„ì‚°í•œ ê³µì • ê°€ì¹˜',
            'ì¢‹ì€ ì‹ í˜¸': 'í˜„ì¬ê°€ë³´ë‹¤ ë†’ì€ ì ì •ê°€',
            'ì£¼ì˜ ì‹ í˜¸': 'í˜„ì¬ê°€ë³´ë‹¤ ë‚®ì€ ì ì •ê°€'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Discount_Pct',
            'í•œêµ­ì–´ ì„¤ëª…': 'í• ì¸ìœ¨ (%)',
            'ì˜ë¯¸ í•´ì„': 'ì ì •ê°€ ëŒ€ë¹„ í˜„ì¬ ì£¼ê°€ê°€ ë‚®ì€ ì •ë„',
            'ì¢‹ì€ ì‹ í˜¸': 'ì–‘ìˆ˜ ê°’ (ì €í‰ê°€)',
            'ì£¼ì˜ ì‹ í˜¸': 'ìŒìˆ˜ ê°’ (ê³ í‰ê°€)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'MktCap($B)',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì‹œê°€ì´ì•¡ (10ì–µ ë‹¬ëŸ¬)',
            'ì˜ë¯¸ í•´ì„': 'íšŒì‚¬ì˜ ì „ì²´ ì‹œì¥ ê°€ì¹˜',
            'ì¢‹ì€ ì‹ í˜¸': 'ì—…ì¢… í‰ê·  ì ì • ê·œëª¨',
            'ì£¼ì˜ ì‹ í˜¸': 'ì§€ë‚˜ì¹˜ê²Œ ì‘ê±°ë‚˜ í° ê·œëª¨'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'PE',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì£¼ê°€ìˆ˜ìµë¹„ìœ¨',
            'ì˜ë¯¸ í•´ì„': 'ì£¼ê°€ë¥¼ ì£¼ë‹¹ìˆœì´ìµìœ¼ë¡œ ë‚˜ëˆˆ ê°’',
            'ì¢‹ì€ ì‹ í˜¸': '15-20 ì´í•˜ (ì—…ì¢…ë³„ ì°¨ì´ ìˆìŒ)',
            'ì£¼ì˜ ì‹ í˜¸': '30 ì´ìƒ (ê³ í‰ê°€ ê°€ëŠ¥ì„±)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'PEG',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì£¼ê°€ìˆ˜ìµë¹„ìœ¨ ì„±ì¥ë¥  ë°°ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'PERì„ ì„±ì¥ë¥ ë¡œ ë‚˜ëˆˆ ê°’',
            'ì¢‹ì€ ì‹ í˜¸': '1.0 ì´í•˜ (ì´ìƒì )',
            'ì£¼ì˜ ì‹ í˜¸': '2.0 ì´ìƒ (ì„±ì¥ ëŒ€ë¹„ ë¹„ìŒˆ)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'EV_EBITDA',
            'í•œêµ­ì–´ ì„¤ëª…': 'ê¸°ì—…ê°€ì¹˜ ëŒ€ë¹„ EBITDA ë¹„ìœ¨',
            'ì˜ë¯¸ í•´ì„': 'ê¸°ì—… ì¸ìˆ˜ ë¹„ìš© ëŒ€ë¹„ ì˜ì—…ì´ìµ',
            'ì¢‹ì€ ì‹ í˜¸': '10 ì´í•˜ (ì €í‰ê°€)',
            'ì£¼ì˜ ì‹ í˜¸': '15 ì´ìƒ (ê³ í‰ê°€)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'FCF_Yield',
            'í•œêµ­ì–´ ì„¤ëª…': 'ììœ í˜„ê¸ˆíë¦„ ìˆ˜ìµë¥ ',
            'ì˜ë¯¸ í•´ì„': 'ì£¼ê°€ ëŒ€ë¹„ ììœ í˜„ê¸ˆíë¦„ ë¹„ìœ¨',
            'ì¢‹ì€ ì‹ í˜¸': '5% ì´ìƒ (ë†’ì€ í˜„ê¸ˆì°½ì¶œ)',
            'ì£¼ì˜ ì‹ í˜¸': '2% ì´í•˜ (ë‚®ì€ í˜„ê¸ˆì°½ì¶œ)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'ROE(info)',
            'í•œêµ­ì–´ ì„¤ëª…': 'ìê¸°ìë³¸ì´ìµë¥ ',
            'ì˜ë¯¸ í•´ì„': 'ìë³¸ ëŒ€ë¹„ ìˆœì´ìµë¥ , ìˆ˜ìµì„± ì§€í‘œ',
            'ì¢‹ì€ ì‹ í˜¸': '15% ì´ìƒ (ë†’ì€ ìë³¸ íš¨ìœ¨)',
            'ì£¼ì˜ ì‹ í˜¸': '8% ì´í•˜ (ë‚®ì€ ìˆ˜ìµì„±)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'GrowthScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì„±ì¥ì„± ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ë§¤ì¶œ ì„±ì¥, ìˆ˜ìµ ì„±ì¥ ë“± ì„±ì¥ì„± ì¢…í•© ì ìˆ˜',
            'ì¢‹ì€ ì‹ í˜¸': '70ì  ì´ìƒ',
            'ì£¼ì˜ ì‹ í˜¸': '40ì  ì´í•˜'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'QualityScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì§ˆ ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ìˆ˜ìµì„±, ì¬ë¬´ê±´ì „ì„±, ê²½ì˜ íš¨ìœ¨ì„± ì¢…í•© ì ìˆ˜',
            'ì¢‹ì€ ì‹ í˜¸': '70ì  ì´ìƒ',
            'ì£¼ì˜ ì‹ í˜¸': '40ì  ì´í•˜'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'ValueScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ê°€ì¹˜ ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ì €í‰ê°€ ì •ë„, ë‹¤ì–‘í•œ ê°€ì¹˜ ì§€í‘œ ì¢…í•© ì ìˆ˜',
            'ì¢‹ì€ ì‹ í˜¸': '70ì  ì´ìƒ',
            'ì£¼ì˜ ì‹ í˜¸': '40ì  ì´í•˜'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'TotalScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì¢…í•© ì´ì ',
            'ì˜ë¯¸ í•´ì„': 'ì„±ì¥ì„± + ì§ˆ + ê°€ì¹˜ ì ìˆ˜ì˜ ê°€ì¤‘í•©',
            'ì¢‹ì€ ì‹ í˜¸': '70ì  ì´ìƒ',
            'ì£¼ì˜ ì‹ í˜¸': '50ì  ì´í•˜'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'ValuationAdjustedScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ê°€ì¹˜ ì¡°ì • ì¢…í•©ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ì¢…í•© ì´ì ì— í• ì¸ìœ¨ì„ ì¶”ê°€ ë°˜ì˜í•œ ìµœì¢… ì ìˆ˜',
            'ì¢‹ì€ ì‹ í˜¸': '80ì  ì´ìƒ',
            'ì£¼ì˜ ì‹ í˜¸': '50ì  ì´í•˜'
        }
    ]

    # íŠ¸ë ˆì´ë”© ì§€í‘œ ì„¤ëª…
    trading_metrics = [
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Sector',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì—…ì¢…/ì„¹í„°',
            'ì˜ë¯¸ í•´ì„': 'ì£¼ì‹ì´ ì†í•œ ì‚°ì—… ë¶„ì•¼',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ì¤‘ê°„',
            'ì¢‹ì€ ì¡°ê±´': 'ëª¨ë©˜í…€ ìˆëŠ” ì„¹í„°'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'Price',
            'í•œêµ­ì–´ ì„¤ëª…': 'í˜„ì¬ ì£¼ê°€',
            'ì˜ë¯¸ í•´ì„': 'ì‹¤ì‹œê°„ ê±°ë˜ ê°€ê²©',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'ì ì • ê°€ê²©ëŒ€'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'DollarVol($M)',
            'í•œêµ­ì–´ ì„¤ëª…': 'ë‹¬ëŸ¬ ê±°ë˜ëŸ‰ (ë°±ë§Œ ë‹¬ëŸ¬)',
            'ì˜ë¯¸ í•´ì„': 'í•˜ë£¨ ê±°ë˜ ëŒ€ê¸ˆ',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë§¤ìš° ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'Swing: 5Mâ†‘, Day: 20Mâ†‘'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'RVOL',
            'í•œêµ­ì–´ ì„¤ëª…': 'ìƒëŒ€ ê±°ë˜ëŸ‰',
            'ì˜ë¯¸ í•´ì„': 'í‰ê·  ëŒ€ë¹„ ê±°ë˜ëŸ‰ ë¹„ìœ¨ (1.0 = í‰ê· )',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'Swing: 1.2â†‘, Day: 2.0â†‘'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'ATR_PCT',
            'í•œêµ­ì–´ ì„¤ëª…': 'í‰ê·  ì‹¤ì œ ë²”ìœ„ (%)',
            'ì˜ë¯¸ í•´ì„': 'ì£¼ê°€ ë³€ë™ì„± í¬ê¸°',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'Swing: 2-8%, Day: 3-15%'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'SMA20',
            'í•œêµ­ì–´ ì„¤ëª…': '20ì¼ ì´ë™í‰ê· ',
            'ì˜ë¯¸ í•´ì„': 'ë‹¨ê¸° ì¶”ì„¸ì„ ',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'ìƒìŠ¹ ì¶”ì„¸, Price > SMA20'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'SMA50',
            'í•œêµ­ì–´ ì„¤ëª…': '50ì¼ ì´ë™í‰ê· ',
            'ì˜ë¯¸ í•´ì„': 'ì¤‘ê¸° ì¶”ì„¸ì„ ',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ì¤‘ê°„',
            'ì¢‹ì€ ì¡°ê±´': 'ìƒìŠ¹ ì¶”ì„¸, SMA20 > SMA50'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'RET5',
            'í•œêµ­ì–´ ì„¤ëª…': '5ì¼ ìˆ˜ìµë¥ ',
            'ì˜ë¯¸ í•´ì„': 'ìµœê·¼ 5ì¼ê°„ ì£¼ê°€ ë“±ë½ìœ¨',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': 'Day: 3%â†‘, Swing: ì–‘ìˆ˜'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'RET20',
            'í•œêµ­ì–´ ì„¤ëª…': '20ì¼ ìˆ˜ìµë¥ ',
            'ì˜ë¯¸ í•´ì„': 'ìµœê·¼ 20ì¼ê°„ ì£¼ê°€ ë“±ë½ìœ¨',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ì¤‘ê°„',
            'ì¢‹ì€ ì¡°ê±´': 'Swing: 0%â†‘ (ì–‘ìˆ˜)'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'MomentumScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ëª¨ë©˜í…€ ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ë‹¨ê¸° ì£¼ê°€ ì¶”ì„¸ ê°•ë„ (ìµœê·¼ ìƒìŠ¹ë ¥)',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë§¤ìš° ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': '70ì  ì´ìƒ'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'TrendScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'íŠ¸ë Œë“œ ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ì¥ê¸° ì¶”ì„¸ ë°©í–¥ì„± (ìƒìŠ¹/í•˜ë½/íš¡ë³´)',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': '70ì  ì´ìƒ'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'LiquidityScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ìœ ë™ì„± ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ë§¤ë§¤ ìš©ì´ì„± (ê±°ë˜ëŸ‰, ê±°ë˜ëŒ€ê¸ˆ ì¢…í•©)',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': '70ì  ì´ìƒ'
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'VolatilityScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ë³€ë™ì„± ì ìˆ˜',
            'ì˜ë¯¸ í•´ì„': 'ì ì • ë³€ë™ì„± (ë„ˆë¬´ ë‚®ê±°ë‚˜ ë†’ì§€ ì•Šì€ ì ì • ìˆ˜ì¤€)',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ì¤‘ê°„',
            'ì¢‹ì€ ì¡°ê±´': '60-80ì '
        },
        {
            'ì§€í‘œ(ì˜ë¬¸)': 'TotalScore',
            'í•œêµ­ì–´ ì„¤ëª…': 'ì¢…í•© ì´ì ',
            'ì˜ë¯¸ í•´ì„': 'íŠ¸ë ˆì´ë”© ì í•©ë„ ì¢…í•© ì ìˆ˜',
            'íŠ¸ë ˆì´ë”© ì¤‘ìš”ë„': 'ë§¤ìš° ë†’ìŒ',
            'ì¢‹ì€ ì¡°ê±´': '70ì  ì´ìƒ'
        }
    ]

    # ì—‘ì…€ íŒŒì¼ ìƒì„±
    ts = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"Stock_Metrics_Explanation_{ts}.xlsx"

    with pd.ExcelWriter(filename, engine='openpyxl') as writer:
        # ë²„í• ì§€í‘œ ì‹œíŠ¸
        buffett_df = pd.DataFrame(buffett_metrics)
        buffett_df.to_excel(writer, sheet_name='ë²„í•_ì§€í‘œ_ì„¤ëª…', index=False)

        # íŠ¸ë ˆì´ë”© ì§€í‘œ ì‹œíŠ¸
        trading_df = pd.DataFrame(trading_metrics)
        trading_df.to_excel(writer, sheet_name='íŠ¸ë ˆì´ë”©_ì§€í‘œ_ì„¤ëª…', index=False)

        # ì‹œíŠ¸ ì„œì‹ ì¡°ì • (ì»¬ëŸ¼ ë„ˆë¹„ ìë™ ì¡°ì •)
        for sheet_name in writer.sheets:
            worksheet = writer.sheets[sheet_name]
            for column in worksheet.columns:
                max_length = 0
                column_letter = column[0].column_letter
                for cell in column:
                    try:
                        if len(str(cell.value)) > max_length:
                            max_length = len(str(cell.value))
                    except:
                        pass
                adjusted_width = min(max_length + 2, 50)
                worksheet.column_dimensions[column_letter].width = adjusted_width

    print(f"âœ… ì§€í‘œ ì„¤ëª… íŒŒì¼ì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤: {filename}")
    print("ğŸ“Š í¬í•¨ëœ ì‹œíŠ¸:")
    print("   - ë²„í•_ì§€í‘œ_ì„¤ëª…: ê°€ì¹˜íˆ¬ì ì§€í‘œ í•´ì„¤")
    print("   - íŠ¸ë ˆì´ë”©_ì§€í‘œ_ì„¤ëª…: ë‹¨ê¸°ë§¤ë§¤ ì§€í‘œ í•´ì„¤")

    return filename


# íŒŒì¼ ìƒì„± ì‹¤í–‰
if __name__ == "__main__":
    explanation_file = create_metrics_explanation_file()